{
    "checksum": "d5a4ef99af6392f3c6a3c3e16d83e931e12edda3994003ede2dd72ac545b69de",
    "data": {
    "id": "ef5761ae-00f5-4afe-8a9d-a10e48e2351f",
    "createdAt": 1759967789521,
    "updatedAt": 1759967789530,
    "title": "No esta funcionando el boton \"confirmar pedido\"",
    "messages": [
        {
            "id": "c08598e2-f4b9-4fe0-9372-7a46aae9308f",
            "role": "user",
            "content": [
                {
                    "type": "text",
                    "text": "No esta funcionando el boton \"confirmar pedido\""
                }
            ],
            "context": {
                "currentFile": {
                    "path": "app/checkout/page.tsx",
                    "fsPath": "C:/Users/ANGEL/Downloads/farmacia-frontend/app/checkout/page.tsx",
                    "sources": [
                        "opened_tab"
                    ],
                    "content": "\"use client\"\n\nimport { useState, useEffect } from \"react\"\nimport { useRouter } from \"next/navigation\"\nimport { useAuth } from \"@/lib/auth\"\nimport { useCart } from \"@/lib/cart\"\nimport { ordersApi, type CheckoutData } from \"@/lib/orders\"\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Label } from \"@/components/ui/label\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\"\nimport { CreditCard, Truck, MapPin, ShoppingBag, ArrowLeft, Lock } from \"lucide-react\"\nimport Image from \"next/image\"\nimport Link from \"next/link\"\nimport { toast } from \"sonner\"\n\nexport default function CheckoutPage() {\n  const router = useRouter()\n  const { user } = useAuth()\n  const { items, total, subtotal, impuestos: tax, envio: shipping, clearCart } = useCart()\n  const [loading, setLoading] = useState(false)\n  const [step, setStep] = useState(1)\n  const [sameAsBilling, setSameAsBilling] = useState(true)\n\n  const [formData, setFormData] = useState<CheckoutData>({\n    items: items.map((item) => ({ productId: item.productoId, quantity: item.cantidad })),\n    shippingAddress: {\n      fullName: user?.name || \"\",\n      street: \"\",\n      city: \"\",\n      state: \"\",\n      zipCode: \"\",\n      phone: \"\",\n    },\n    billingAddress: {\n      fullName: user?.name || \"\",\n      street: \"\",\n      city: \"\",\n      state: \"\",\n      zipCode: \"\",\n    },\n    paymentMethod: \"credit_card\",\n    paymentDetails: {\n      cardNumber: \"\",\n      expiryDate: \"\",\n      cvv: \"\",\n      cardholderName: user?.name || \"\",\n    },\n  })\n\n  // Update formData items when cart items change\n  useEffect(() => {\n    setFormData(prev => ({\n      ...prev,\n      items: items.map((item) => ({ productId: item.productoId, quantity: item.cantidad }))\n    }))\n  }, [items])\n\n  const handleInputChange = (section: keyof CheckoutData, field: string, value: string) => {\n    setFormData((prev) => ({\n      ...prev,\n      [section]: {\n        ...prev[section],\n        [field]: value,\n      },\n    }))\n  }\n\n  const handleSubmitOrder = async () => {\n    console.log(\"üü¢ handleSubmitOrder ejecutado\")\n    if (!user) {\n      toast.error(\"Debes iniciar sesi√≥n para realizar una compra\")\n      router.push(\"/login\")\n      return\n    }\n\n    console.log(\"üë§ Usuario:\", user)\n    console.log(\"üì¶ FormData enviado:\", formData)\n\n    setLoading(true)\n    try {\n      console.log(\"‚û°Ô∏è Intentando crear orden...\")\n      const order = await ordersApi.createOrder(formData)\n      console.log(\"‚úÖ Respuesta del backend:\", order)\n      clearCart()\n      toast.success(\"¬°Pedido realizado exitosamente!\")\n      router.push(`/pedidos/${order.id}`)\n    } catch (error) {\n      console.error(\"‚ùå Error al procesar pedido:\", error)\n      toast.error(\"Error al procesar el pedido. Int√©ntalo de nuevo.\")\n    } finally {\n      console.log(\"üîö handleSubmitOrder finalizado\")\n      setLoading(false)\n    }\n  }\n\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Card className=\"w-full max-w-md\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center\">\n              <Lock className=\"mx-auto h-12 w-12 text-emerald-600 mb-4\" />\n              <h2 className=\"text-xl font-semibold mb-2\">Inicia Sesi√≥n</h2>\n              <p className=\"text-muted-foreground mb-4\">Debes iniciar sesi√≥n para continuar con tu compra</p>\n              <div className=\"space-y-2\">\n                <Button asChild className=\"w-full\">\n                  <Link href=\"/login\">Iniciar Sesi√≥n</Link>\n                </Button>\n                <Button variant=\"outline\" asChild className=\"w-full bg-transparent\">\n                  <Link href=\"/registro\">Crear Cuenta</Link>\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  if (items.length === 0) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Card className=\"w-full max-w-md\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center\">\n              <ShoppingBag className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n              <h2 className=\"text-xl font-semibold mb-2\">Carrito Vac√≠o</h2>\n              <p className=\"text-muted-foreground mb-4\">No tienes productos en tu carrito para procesar</p>\n              <Button asChild>\n                <Link href=\"/catalogo\">Explorar Productos</Link>\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"mb-6\">\n        <Button variant=\"ghost\" asChild className=\"mb-4\">\n          <Link href=\"/carrito\" className=\"flex items-center gap-2\">\n            <ArrowLeft className=\"h-4 w-4\" />\n            Volver al Carrito\n          </Link>\n        </Button>\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Finalizar Compra</h1>\n        <p className=\"text-gray-600\">Completa tu pedido de forma segura</p>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n        {/* Checkout Form */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          {/* Step 1: Shipping Address */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <MapPin className=\"h-5 w-5\" />\n                Direcci√≥n de Env√≠o\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"fullName\">Nombre Completo</Label>\n                  <Input\n                    id=\"fullName\"\n                    value={formData.shippingAddress.fullName}\n                    onChange={(e) => handleInputChange(\"shippingAddress\", \"fullName\", e.target.value)}\n                    placeholder=\"Tu nombre completo\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"phone\">Tel√©fono</Label>\n                  <Input\n                    id=\"phone\"\n                    value={formData.shippingAddress.phone}\n                    onChange={(e) => handleInputChange(\"shippingAddress\", \"phone\", e.target.value)}\n                    placeholder=\"+57 300 123 4567\"\n                  />\n                </div>\n              </div>\n              <div>\n                <Label htmlFor=\"street\">Direcci√≥n</Label>\n                <Input\n                  id=\"street\"\n                  value={formData.shippingAddress.street}\n                  onChange={(e) => handleInputChange(\"shippingAddress\", \"street\", e.target.value)}\n                  placeholder=\"Calle, n√∫mero, apartamento\"\n                />\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"city\">Ciudad</Label>\n                  <Input\n                    id=\"city\"\n                    value={formData.shippingAddress.city}\n                    onChange={(e) => handleInputChange(\"shippingAddress\", \"city\", e.target.value)}\n                    placeholder=\"Ciudad\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"state\">Departamento</Label>\n                  <Input\n                    id=\"state\"\n                    value={formData.shippingAddress.state}\n                    onChange={(e) => handleInputChange(\"shippingAddress\", \"state\", e.target.value)}\n                    placeholder=\"Departamento\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"zipCode\">C√≥digo Postal</Label>\n                  <Input\n                    id=\"zipCode\"\n                    value={formData.shippingAddress.zipCode}\n                    onChange={(e) => handleInputChange(\"shippingAddress\", \"zipCode\", e.target.value)}\n                    placeholder=\"110111\"\n                  />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Step 2: Payment Method */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <CreditCard className=\"h-5 w-5\" />\n                M√©todo de Pago\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <RadioGroup\n                value={formData.paymentMethod}\n                onValueChange={(value) => setFormData((prev) => ({ ...prev, paymentMethod: value as any }))}\n              >\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"credit_card\" id=\"credit_card\" />\n                  <Label htmlFor=\"credit_card\">Tarjeta de Cr√©dito</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"debit_card\" id=\"debit_card\" />\n                  <Label htmlFor=\"debit_card\">Tarjeta D√©bito</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"cash_on_delivery\" id=\"cash_on_delivery\" />\n                  <Label htmlFor=\"cash_on_delivery\">Pago Contra Entrega</Label>\n                </div>\n              </RadioGroup>\n\n              {(formData.paymentMethod === \"credit_card\" || formData.paymentMethod === \"debit_card\") && (\n                <div className=\"space-y-4 pt-4 border-t\">\n                  <div>\n                    <Label htmlFor=\"cardholderName\">Nombre del Titular</Label>\n                    <Input\n                      id=\"cardholderName\"\n                      value={formData.paymentDetails?.cardholderName || \"\"}\n                      onChange={(e) => handleInputChange(\"paymentDetails\", \"cardholderName\", e.target.value)}\n                      placeholder=\"Nombre como aparece en la tarjeta\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"cardNumber\">N√∫mero de Tarjeta</Label>\n                    <Input\n                      id=\"cardNumber\"\n                      value={formData.paymentDetails?.cardNumber || \"\"}\n                      onChange={(e) => handleInputChange(\"paymentDetails\", \"cardNumber\", e.target.value)}\n                      placeholder=\"1234 5678 9012 3456\"\n                    />\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div>\n                      <Label htmlFor=\"expiryDate\">Fecha de Vencimiento</Label>\n                      <Input\n                        id=\"expiryDate\"\n                        value={formData.paymentDetails?.expiryDate || \"\"}\n                        onChange={(e) => handleInputChange(\"paymentDetails\", \"expiryDate\", e.target.value)}\n                        placeholder=\"MM/AA\"\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"cvv\">CVV</Label>\n                      <Input\n                        id=\"cvv\"\n                        value={formData.paymentDetails?.cvv || \"\"}\n                        onChange={(e) => handleInputChange(\"paymentDetails\", \"cvv\", e.target.value)}\n                        placeholder=\"123\"\n                      />\n                    </div>\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Order Summary */}\n        <div className=\"space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Resumen del Pedido</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {items.map((item) => (\n                <div key={item.id} className=\"flex items-center gap-3\">\n                  <div className=\"relative h-12 w-12 rounded-md overflow-hidden\">\n                    <Image src={item.imagen || \"/placeholder.svg\"} alt={item.nombre} fill className=\"object-cover\" />\n                  </div>\n                  <div className=\"flex-1\">\n                    <div className=\"font-medium text-sm\">{item.nombre}</div>\n                    <div className=\"text-sm text-muted-foreground\">Cantidad: {item.cantidad}</div>\n                  </div>\n                  <div className=\"font-medium\">${((item.precioOferta || item.precio) * item.cantidad).toFixed(2)}</div>\n                </div>\n              ))}\n\n              <Separator />\n\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between\">\n                  <span>Subtotal</span>\n                  <span>${subtotal.toFixed(2)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>Impuestos</span>\n                  <span>${tax.toFixed(2)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>Env√≠o</span>\n                  <span>{shipping === 0 ? \"Gratis\" : `$${shipping.toFixed(2)}`}</span>\n                </div>\n                <Separator />\n                <div className=\"flex justify-between font-semibold text-lg\">\n                  <span>Total</span>\n                  <span>${total.toFixed(2)}</span>\n                </div>\n              </div>\n\n              <Button onClick={handleSubmitOrder} disabled={loading} className=\"w-full\" size=\"lg\">\n                {loading ? \"Procesando...\" : \"Confirmar Pedido\"}\n              </Button>\n\n              <div className=\"text-xs text-muted-foreground text-center\">\n                Al confirmar tu pedido, aceptas nuestros t√©rminos y condiciones\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <Truck className=\"h-4 w-4\" />\n                <span>Entrega estimada: 2-3 d√≠as h√°biles</span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  )\n}\n",
                    "language": "typescript jsx"
                }
            },
            "createdAt": 1759967789530,
            "isInternal": false,
            "rawContent": {
                "type": "doc",
                "content": [
                    {
                        "type": "paragraph",
                        "content": [
                            {
                                "type": "text",
                                "text": "No esta funcionando el boton \"confirmar pedido\""
                            }
                        ]
                    }
                ]
            },
            "autoAppliedRules": []
        }
    ],
    "isAgent": true,
    "isNameGenerated": true,
    "isCustomAgent": false,
    "isUnitTestsAgent": false,
    "isE2EAgent": false,
    "isWebDevAgent": false,
    "isQnaAgent": false,
    "isRepoInfoAgent": false,
    "model": "default"
}
}